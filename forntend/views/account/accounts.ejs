<% layout('layouts/boilerplates.ejs') %>
<style>
    *{
       color: white;
   }

   .id{
       display: none;
   }

   h3{
       font-size: 2rem;
       margin: 1rem;
   }
 button{
       padding: 5px 10px;
       width: 5rem;
       color: white;
       background-color: rgb(186, 0, 0);
       border-radius: 5px;
       border: none;
       margin-left: 5px;
   }
hr{
    background-color: white;
}
 

   
table {
   width: 80%;
   border-collapse: collapse; 
   margin: 20px 0; 
   font-family: Arial, sans-serif;
   color: #333;
   border: none; 
}


th {
   background-color: #300101; 
   color: white; 
   padding: 10px 15px; 
   text-align: left; 
   font-size: 16px; 
   border: none; 
}


td {
   padding: 8px 15px; 
   text-align: left; 
   border: none; 
}
tr:nth-child(even) {
   background-color: #401f1f; 
}

tr:hover {
   background-color: #2b2b2b; 
}





tfoot td {
   font-weight: bold; 
   background-color: #f1f1f1; 
   text-align: right; 
   padding: 10px 15px;
   border: none; 
}


@media screen and (max-width: 600px) {
   table {
       width: 100%;
       font-size: 14px; 
   }

   th, td {
       padding: 8px; 
   }
}
.btndiv{
   display: flex;
}


.countuser{
display: flex;
gap: 1rem;
margin: 2rem;
}

input {
   border: none;
   border-bottom: solid white 1.5px;
   margin-left: 2rem;
   width: 15rem;
   background-color: transparent; 
   color: white; 
   padding: 0.5rem; 
   font-size: 1rem; 
}

input:focus {
   outline: none; 
   border-bottom: solid #d20404 2px; 
  
}

input {
   transition: border-bottom 0.3s, box-shadow 0.3s;
}
select{
   width: 12rem;
   height: 1.7rem;
   
}
</style>

<div class="home-header-section">
    <header class="header home-header-section">
        <div class="main-header">
            <div class="container">
                <nav class="navbar navbar-expand-lg navbar-light p-0">
                    <a class="navbar-brand pt-0" href="/"><img src="/images/redlight-logo.png" alt=""
                            class="logo" /></a>
                    <button class="navbar-toggler collapsed" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                        <span class="navbar-toggler-icon"></span>
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav">
                            <li class="nav-item ">
                                <a class="nav-link text-decoration-none navbar-text-color home-margin-top"
                                    href="/">Home</a>
                            </li>
                            <!-- <span class="sr-only">(current)</span> -->
                            <li class="nav-item">
                                <a class="nav-link text-decoration-none navbar-text-color"
                                    href="/about">About</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-decoration-none navbar-text-color" href="/und">Membership</a>
                            </li>

                            
                            <% if(curUser && (curUser.role =="communityMember" || curUser.role =="admin")){ %>
                            <li class="nav-item dropdown redlight-dropdown ">
                                <a class="nav-link dropdown-toggle " href="/account" id="navbarDropdown2" role="button"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Control Panel</a>
                                <div class="dropdown-menu dropdown-content-redlight blogs-section-drop-down">
                                    <ul class="list-unstyled">
                                        <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                href="/admin/distributecertification">Certificate</a></li>
                                        <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                href="/account">Account</a></li>
                                        <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                href="/account/promotion">Promotion & Users</a></li>
                                       

                                    </ul>
                                </div>
                            </li>
                            <% } %>
                            
                         
                                    
                            <li class="nav-item ">
                                <a class="nav-link text-decoration-none navbar-text-color "
                                    href="/contactus">Contact
                                    Us</a>
                            </li>
                        </ul>
                        <hr>

                        <ul class="navbar-nav ">
                            <li class="nav-item dropdown redlight-dropdown">
                                <a class="nav-link dropdown-toggle " href="/profile" id="navbarDropdown"
                                    role="button" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false">Profile</a>

                                <div class="dropdown-menu dropdown-content-redlight">
                                    <ul class="list-unstyled">
                                        <% if(!curUser){%>
                                            <li class="nav-item"> <a class="dropdown-item nav-link"
                                                    href="/user/login">Login</a>
                                            </li>
                                            <li class="nav-item"> <a class="dropdown-item nav-link"
                                                    href="/user/signup">Sing
                                                    Up</a></li>
                                            <% } if(curUser){%>
                                                <li class="nav-item"> <a class="dropdown-item nav-link"
                                                        href="/profile">Profile</a></li>
                                                <li class="nav-item"> <a class="dropdown-item nav-link"
                                                        href="/user/logout">Log
                                                        out</a></li>
                                                <% }%>

                                    </ul>
                                </div>
                            </li>
                        </ul>

                    </div>
                </nav>
            </div>
        </div>
    </header>
   
        
   <h3>Balance <i>Rs <%= acc %></i></h3>
   <h3>Transaction</h3>
   <form method="post" action="/account">
       <label for="transactionType">Transaction Type:</label>
       <select id="transactionType" name="type" required>
           <option value="deposit">Deposit</option>
           <option value="withdrawal">Withdrawal</option>
       </select>
   
       <label for="amount">Amount:</label>
       <input type="number" id="amount" name="amount" min="1" required>
   
       <label for="purpose">Purpose:</label>
       <input type="text" id="purpose" name="purpose" required>
   
       <button type="button" class="btns">Submit</button>
   </form>
   <br>
   <hr>
   <br>
   <section>
       <h3>Deposit</h3>
       <table>
           <tr>
               <th>Date</th>
               <th>Amount</th>
               <th>Purpose</th>
           </tr>
           <tbody id="depositTable">
               <% details.filter(detail => detail.type === "deposit").forEach((detail, index) => { %>
                   <tr>
                       <td>
                        <%= new Date(detail.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %>

                       </td>
                       <td>Rs: <%= detail.amount %></td>
                       <td>
                           <%= detail.purpose %>
                       </td>
                   </tr>
               <% }); %>
           </tbody>
       </table>
    
   </section>
   <br>
   <hr>
   <br>
   <section>
       <h3>Withdrawal</h3>
       <table>
           <tr>
               <th>Date</th>
               <th>Amount</th>
               <th>Purpose</th>
           </tr>
           <tbody id="withdrawalTable">
               <% details.filter(detail => detail.type === "withdrawal").forEach((detail, inde) => { %>
                   <tr>
                       <td>
                        <%= new Date(detail.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %>

                       </td>
                       <td>Rs: <%= detail.amount %></td>
                       <td>
                           <%= detail.purpose %>
                       </td>
                   </tr>
               <% }); %>
           </tbody>
       </table>
     <br><br>
   </section>
</div>
   <script>
    //    function filterRows(tableId, inputId) {
    //        const numRows = document.getElementById(inputId).value;
    //        const rows = document.querySelectorAll(`#${tableId} tr`);
    //        rows.forEach((row, index) => {
    //            row.style.display = index < numRows ? "" : "none";
    //        });
    //    }
   
    //    document.getElementById("noOfValueDeposit").addEventListener("input", () => {
    //        filterRows("depositTable", "noOfValueDeposit");
    //    });
   
    //    document.getElementById("noOfValueWithdrawal").addEventListener("input", () => {
    //        filterRows("withdrawalTable", "noOfValueWithdrawal");
    //    });
   
    //    // Initially call the filter function to show the specified number of rows
    //    filterRows("depositTable", "noOfValueDeposit");
    //    filterRows("withdrawalTable", "noOfValueWithdrawal");
   

  function confirmSubmission() {
    return confirm("Are you sure you want to submit this transaction?");
  }

  let submit = document.querySelector(".btns");
  submit.addEventListener("click", async function(event) {
    if (!confirmSubmission()) return;
    spiner.style.visibility = "visible";
    const formData = new FormData(submit.closest("form"));
    const data = {};
    formData.forEach((value, key) => {
      data[key] = value;
    });
    spiner.style.visibility = "visible";
    try {
      const response = await fetch("/account", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      });

      const result = await response.json();
     
      if (result.success) {
        sessbox.style.display = 'block';
        sesmsg.innerText = result.success;
        submit.closest("form").reset();
        
      } else {
        errbox.style.display = "block";
        errmsg.innerText = result.error;
                        
      }
    } catch (error) {
      console.error("Error submitting form:", error);
      errmsg.innerText = "There was an error processing your request.";
     
    }
      spiner.style.visibility = "hidden";
  });


   </script>
   