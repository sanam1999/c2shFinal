<% layout("/layouts/boilerplates.ejs") %>
    <style>
        .table-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Arial', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .search-container {
            margin-bottom: 20px;
        }

        .search-bar {
            padding: 10px;
            width: 300px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        .deletec {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .reset-btn {
            margin-left: 10px;
            padding: 10px 20px;
            background-color: #be0000;
            border: none;
            color: white;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        .reset-btn:hover {
            background-color: rgb(160, 0, 0);
        }


        .title1 {
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffffff;
        }

        .styled-table {
            width: 100%;
            border-collapse: collapse;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .styled-table thead {
            background-color: #1f1f1f;
            color: #ffffff;
            font-weight: bold;
        }

        .styled-table th,
        .styled-table td {
            padding: 0px;
            text-align: center;
            border: 1px solid #333333;
            word-break: break-word;
        }

        .styled-table tbody tr:nth-child(odd) {
            background-color: #1a1a1a;
        }

        .styled-table tbody tr:nth-child(even) {
            background-color: #2a2a2a;
        }

        .qr {
            font-size: 0.9rem;
            color: #b3b3b3;
        }

        .qr a {
            color: #1e90ff;
            text-decoration: none;
        }

        .qr a:hover {
            text-decoration: underline;
        }

        .qr-text {
            font-size: 0.8rem;
            line-height: 1.2;
            max-width: 250px;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            color: #cfcfcf;
        }

        .delete-btn {
            background-color: #ff4d4d;
            color: #ffffff;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }

        .delete-btn:hover {
            background-color: #ff1a1a;
        }

        .download-btn {
            background-color: #e00000;
            color: #ffffff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            cursor: pointer;
            float: right;
        }

        .download-btn:hover {
            background-color: #ce0000;
        }

        /* Table Scroll for Small Screens */
        .table-container {
            overflow-x: auto;
        }
    </style>

    <!-- HEADER-SECTION -->
    <div class="home-header-section">
        <header class="header home-header-section">
            <div class="main-header">
                <div class="container">
                    <nav class="navbar navbar-expand-lg navbar-light p-0">
                        <a class="navbar-brand pt-0" href="/"><img src="/images/redlight-logo.png" alt=""
                                class="logo" /></a>
                        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                            <span class="navbar-toggler-icon"></span>
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <li class="nav-item ">
                                    <a class="nav-link text-decoration-none navbar-text-color home-margin-top"
                                        href="/">Home</a>
                                </li>
                                <!-- <span class="sr-only">(current)</span> -->
                                <li class="nav-item">
                                    <a class="nav-link text-decoration-none navbar-text-color"
                                        href="/about">About</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-decoration-none navbar-text-color" href="/und">Membership</a>
                                </li>

                                <li class="nav-item dropdown redlight-dropdown ">
                                    <a class="nav-link dropdown-toggle " href="/und" id="navbarDropdown2" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Blogs</a>
                                    <div class="dropdown-menu dropdown-content-redlight blogs-section-drop-down">
                                        <ul class="list-unstyled">
                                            <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                    href="/und">Events</a></li>
                                            <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                    href="/und">Up
                                                    coming Events</a></li>
                                            <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                    href="/und">Blogs</a></li>
                                            <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                    href="/und">Projects</a></li>
                                            <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                    href="/und">Notice</a></li>

                                        </ul>
                                    </div>
                                </li>
                                <% if(curUser && (curUser.role =="communityMember" || curUser.role =="admin")){ %>
                                <li class="nav-item dropdown redlight-dropdown ">
                                    <a class="nav-link dropdown-toggle " href="/account" id="navbarDropdown2" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Control Panel</a>
                                    <div class="dropdown-menu dropdown-content-redlight blogs-section-drop-down">
                                        <ul class="list-unstyled">
                                            <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                    href="/admin/distributecertification">Certificate</a></li>
                                            <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                    href="/account">Account</a></li>
                                            <li class="nav-item"> <a class="dropdown-item fierce-menu nav-link"
                                                    href="/account/promotion">Promotion & Users</a></li>
                                           

                                        </ul>
                                    </div>
                                </li>
                                <% } %>
                                <li class="nav-item navbar-text-color "><a
                                        class="nav-link text-decoration-none contact-us-margin navbar-text-color"
                                        href="/und">Courses</a></li>
                                
                                <li class="nav-item ">
                                    <a class="nav-link text-decoration-none navbar-text-color "
                                        href="/contactus">Contact
                                        Us</a>
                                </li>
                            </ul>
                            <hr>

                            <ul class="navbar-nav ">
                                <li class="nav-item dropdown redlight-dropdown">
                                    <a class="nav-link dropdown-toggle " href="/profile" id="navbarDropdown"
                                        role="button" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">Profile</a>

                                    <div class="dropdown-menu dropdown-content-redlight">
                                        <ul class="list-unstyled">
                                            <% if(!curUser){%>
                                                <li class="nav-item"> <a class="dropdown-item nav-link"
                                                        href="/user/login">Login</a>
                                                </li>
                                                <li class="nav-item"> <a class="dropdown-item nav-link"
                                                        href="/user/signup">Signup</a></li>
                                                <% } if(curUser){%>
                                                    <li class="nav-item"> <a class="dropdown-item nav-link"
                                                            href="/profile">Profile</a></li>
                                                    <li class="nav-item"> <a class="dropdown-item nav-link"
                                                            href="/user/logout">Log
                                                            out</a></li>
                                                    <% }%>

                                        </ul>
                                    </div>
                                </li>
                            </ul>

                        </div>
                    </nav>
                </div>
            </div>
        </header>

        <br><br>
        <div class="table-container">
            <div class="title1">
                <%= certificate.title %>
            </div>

            <!-- Search Bar -->
            <div class="search-container">
                <input type="text" id="search-bar" class="search-bar" placeholder="Search by name or email..."
                    oninput="filterTable()" />
                <button id="reset-btn" class="reset-btn" onclick="resetSearch()">Reset</button>
                <button id="download-btn" class="download-btn">Download Table</button>
            </div>



            <table class="styled-table" id="user-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>QR Code Text</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% certificate.user.forEach(function(attendee) { %>
                        <tr>
                            <td>
                                <%= attendee.user.userInfo.firstName + " " + attendee.user.userInfo.lastName %>
                            </td>
                            <td>

                                <%= attendee.user.username %>

                            </td>
                            <td class="qr qr-text">
                                <a href="<%= attendee.qrcode %>">
                                    <%= attendee.qrcode%>
                                </a>
                            </td>
                            <td>
                                <form action="/admin/remove?uid=<%= attendee._id %>&cid=<%= certificate._id%>"
                                    method="post">
                                    <button type="submit" class="delete-btn">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
            </table>
        </div>
    </div>

        <script>
            // Filter table rows based on search input
            function filterTable() {
                const searchInput = document.getElementById("search-bar").value.toLowerCase();
                const rows = document.querySelectorAll("#user-table tbody tr");

                rows.forEach(row => {
                    const name = row.querySelector("td:nth-child(1)").textContent.toLowerCase();
                    const email = row.querySelector("td:nth-child(2)").textContent.toLowerCase();

                    if (name.includes(searchInput) || email.includes(searchInput)) {
                        row.style.display = ""; // Show row
                    } else {
                        row.style.display = "none"; // Hide row
                    }
                });
            }

            // Reset the search bar and show all rows
            function resetSearch() {
                const searchBar = document.getElementById("search-bar");
                searchBar.value = ""; // Clear search bar
                filterTable(); // Reset table display
            }
        </script>


        <br><br>
        <script>
            document.getElementById("download-btn").addEventListener("click", () => {
                const table = document.querySelector(".styled-table");
                const title = document.querySelector(".title1").textContent.trim(); // Get the table name

                let csv = [];

                // Loop through table rows
                const rows = table.querySelectorAll("tr");
                rows.forEach(row => {
                    const cells = Array.from(row.querySelectorAll("th, td"));

                    // Exclude Action column by skipping the last cell in each row
                    const rowData = cells.slice(0, -1).map(cell => `"${cell.textContent.trim().replace(/"/g, '""')}"`);
                    csv.push(rowData.join(","));
                });

                // Convert to CSV
                const csvContent = "data:text/csv;charset=utf-8," + csv.join("\n");

                // Create a download link
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `${title}.csv`);

                // Append link and trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });







        </script>